<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Institution Rankings - ResQTech</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">ResQTech</a>
                <div class="user-info">
                    <a href="javascript:history.back()" class="btn btn-outline btn-sm">‚Üê Back</a>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Page Header -->
        <section class="mb-8">
            <div class="card">
                <div class="card-header text-center">
                    <h1 class="card-title">üèÜ Institution Resilience Rankings</h1>
                    <p class="card-description">Regional leaderboard based on emergency preparedness and response capabilities</p>
                </div>
            </div>
        </section>

        <!-- Performance Categories -->
        <section class="mb-8">
            <div class="grid grid-4">
                <div class="card text-center">
                    <div class="card-content">
                        <div style="font-size: 2rem; margin-bottom: var(--spacing-2); color: var(--success-color);">ü•á</div>
                        <div class="stat-number text-success">90-100</div>
                        <div class="stat-label">Excellent</div>
                    </div>
                </div>
                <div class="card text-center">
                    <div class="card-content">
                        <div style="font-size: 2rem; margin-bottom: var(--spacing-2); color: var(--info-color);">ü•à</div>
                        <div class="stat-number text-primary">80-89</div>
                        <div class="stat-label">Good</div>
                    </div>
                </div>
                <div class="card text-center">
                    <div class="card-content">
                        <div style="font-size: 2rem; margin-bottom: var(--spacing-2); color: var(--accent-color);">ü•â</div>
                        <div class="stat-number text-warning">70-79</div>
                        <div class="stat-label">Average</div>
                    </div>
                </div>
                <div class="card text-center">
                    <div class="card-content">
                        <div style="font-size: 2rem; margin-bottom: var(--spacing-2); color: var(--primary-color);">üìà</div>
                        <div class="stat-number text-primary">Below 70</div>
                        <div class="stat-label">Needs Improvement</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Charts and Rankings -->
        <div class="grid grid-2 mb-8">
            <!-- Performance Chart -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìä Performance Distribution</h3>
                    <p class="card-description">Score distribution across all institutions</p>
                </div>
                <div class="card-content">
                    <canvas id="performanceChart" width="400" height="300"></canvas>
                </div>
            </div>

            <!-- Top Performers -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üåü Top Performers</h3>
                    <p class="card-description">Leading institutions this month</p>
                </div>
                <div class="card-content">
                    <div class="activity-list" id="top-performers">
                        <div class="activity-item">
                            <div class="activity-icon bg-warning" style="font-weight: bold; color: white;">1</div>
                            <div class="activity-content">
                                <div class="activity-title">Sunrise Public School</div>
                                <div class="activity-time">
                                    <span class="badge badge-safe">Excellent</span> ‚Ä¢ Score: 88
                                </div>
                            </div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon" style="background: #c0c0c0; font-weight: bold; color: white;">2</div>
                            <div class="activity-content">
                                <div class="activity-title">BPIT College</div>
                                <div class="activity-time">
                                    <span class="badge badge-safe">Excellent</span> ‚Ä¢ Score: 84
                                </div>
                            </div>
                        </div>
                        <div class="activity-icon" style="background: #cd7f32; font-weight: bold; color: white;">3</div>
                            <div class="activity-content">
                                <div class="activity-title">Greenfield High</div>
                                <div class="activity-time">
                                    <span class="badge badge-medium">Good</span> ‚Ä¢ Score: 79
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Full Rankings Table -->
        <section class="mb-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìã Complete Rankings</h3>
                    <p class="card-description">All institutions ranked by resilience score</p>
                </div>
                <div class="card-content">
                    <div class="table-container" style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="border-bottom: 2px solid var(--gray-200);">
                                    <th style="padding: var(--spacing-3); text-align: left; font-weight: 600;">Rank</th>
                                    <th style="padding: var(--spacing-3); text-align: left; font-weight: 600;">Institution</th>
                                    <th style="padding: var(--spacing-3); text-align: left; font-weight: 600;">Location</th>
                                    <th style="padding: var(--spacing-3); text-align: center; font-weight: 600;">Score</th>
                                    <th style="padding: var(--spacing-3); text-align: center; font-weight: 600;">Category</th>
                                    <th style="padding: var(--spacing-3); text-align: center; font-weight: 600;">Last Drill</th>
                                </tr>
                            </thead>
                            <tbody id="rankings-table">
                                <!-- Rankings will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Your Institution Details -->
        <section class="mb-8">
            <div class="card" style="border-left: 4px solid var(--accent-color); background: linear-gradient(135deg, #fef3c7, #fed7aa);">
                <div class="card-header">
                    <h3 class="card-title">üéØ Your Institution Performance</h3>
                    <p class="card-description">Detailed breakdown of your current standing</p>
                </div>
                <div class="card-content">
                    <div class="grid grid-3 mb-6">
                        <div class="text-center">
                            <div class="stat-number text-primary">4th</div>
                            <div class="stat-label">Current Rank</div>
                        </div>
                        <div class="text-center">
                            <div class="stat-number text-warning">72</div>
                            <div class="stat-label">Resilience Score</div>
                        </div>
                        <div class="text-center">
                            <div class="stat-number text-info">+8</div>
                            <div class="stat-label">Points to Next Rank</div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 style="margin-bottom: var(--spacing-2);">Areas for Improvement:</h4>
                        <ul style="padding-left: var(--spacing-6);">
                            <li>Reduce average evacuation time by 30 seconds</li>
                            <li>Conduct 2 more training sessions this quarter</li>
                            <li>Address 3 outstanding safety reports</li>
                            <li>Improve emergency communication systems</li>
                        </ul>
                    </div>
                    
                    <div class="progress-container mb-2">
                        <div class="progress-bar" style="width: 72%;"></div>
                    </div>
                    <div class="progress-text">72% - Average Category</div>
                </div>
                <div class="card-footer">
                    <a href="/admin-dashboard" class="btn btn-primary w-full">View Improvement Plan</a>
                </div>
            </div>
        </section>

        <!-- Methodology -->
        <section>
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìñ Scoring Methodology</h3>
                    <p class="card-description">How resilience scores are calculated</p>
                </div>
                <div class="card-content">
                    <div class="grid grid-2" style="gap: var(--spacing-6);">
                        <div>
                            <h4 style="margin-bottom: var(--spacing-3);">Key Metrics (100 points total):</h4>
                            <ul style="padding-left: var(--spacing-6); line-height: 1.8;">
                                <li><strong>Drill Performance (30 pts):</strong> Evacuation time, participation rate</li>
                                <li><strong>Training Completion (25 pts):</strong> Staff and student training rates</li>
                                <li><strong>Safety Infrastructure (20 pts):</strong> Equipment, signage, maintenance</li>
                                <li><strong>Response Time (15 pts):</strong> Emergency response efficiency</li>
                                <li><strong>Documentation (10 pts):</strong> Plans, reports, compliance</li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="margin-bottom: var(--spacing-3);">Updated:</h4>
                            <p style="margin-bottom: var(--spacing-3);">Rankings are updated monthly based on:</p>
                            <ul style="padding-left: var(--spacing-6); line-height: 1.8;">
                                <li>Drill performance data</li>
                                <li>Training completion rates</li>
                                <li>Safety incident reports</li>
                                <li>Equipment inspection results</li>
                                <li>Compliance audits</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="/js/main.js"></script>
    <script>
        let rankingsData = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadRankings();
            initializeChart();
        });

        async function loadRankings() {
            try {
                const response = await fetch('/api/rankings');
                rankingsData = await response.json();
                displayRankings();
            } catch (error) {
                console.error('Error loading rankings:', error);
                // Fallback data
                rankingsData = [
                    { rank: 1, institution: "Sunrise Public School", score: 88, category: "Excellent", location: "California", lastDrill: "2024-01-15" },
                    { rank: 2, institution: "BPIT College", score: 84, category: "Excellent", location: "Delhi", lastDrill: "2024-01-20" },
                    { rank: 3, institution: "Greenfield High School", score: 79, category: "Good", location: "Texas", lastDrill: "2024-01-18" },
                    { rank: 4, institution: "Your Institution", score: 72, category: "Average", location: "New York", lastDrill: "2024-01-22" },
                    { rank: 5, institution: "Oakwood Elementary", score: 68, category: "Average", location: "Florida", lastDrill: "2024-01-10" },
                    { rank: 6, institution: "Riverside High", score: 65, category: "Average", location: "Oregon", lastDrill: "2024-01-12" },
                    { rank: 7, institution: "Mountain View School", score: 62, category: "Needs Improvement", location: "Colorado", lastDrill: "2024-01-08" },
                    { rank: 8, institution: "Central Academy", score: 58, category: "Needs Improvement", location: "Illinois", lastDrill: "2024-01-05" }
                ];
                displayRankings();
            }
        }

        function displayRankings() {
            const tableBody = document.getElementById('rankings-table');
            tableBody.innerHTML = '';

            rankingsData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid var(--gray-200)';
                
                // Highlight current institution
                if (item.institution === 'Your Institution') {
                    row.style.background = 'linear-gradient(135deg, #fef3c7, #fed7aa)';
                    row.style.fontWeight = '600';
                }

                const badgeClass = getCategoryBadgeClass(item.category);
                const rankIcon = getRankIcon(item.rank);

                row.innerHTML = `
                    <td style="padding: var(--spacing-3);">
                        <div class="flex items-center" style="gap: var(--spacing-2);">
                            <span style="font-size: var(--font-size-lg);">${rankIcon}</span>
                            <span style="font-weight: 600;">#${item.rank}</span>
                        </div>
                    </td>
                    <td style="padding: var(--spacing-3);">
                        <div style="font-weight: 500;">${item.institution}</div>
                    </td>
                    <td style="padding: var(--spacing-3);">
                        <span style="color: var(--gray-600);">${item.location}</span>
                    </td>
                    <td style="padding: var(--spacing-3); text-align: center;">
                        <div style="font-weight: 600; font-size: var(--font-size-lg);">${item.score}</div>
                    </td>
                    <td style="padding: var(--spacing-3); text-align: center;">
                        <span class="badge ${badgeClass}">${item.category}</span>
                    </td>
                    <td style="padding: var(--spacing-3); text-align: center;">
                        <span style="color: var(--gray-600); font-size: var(--font-size-sm);">${formatDate(item.lastDrill)}</span>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function getCategoryBadgeClass(category) {
            switch (category) {
                case 'Excellent': return 'badge-safe';
                case 'Good': return 'badge-low';
                case 'Average': return 'badge-medium';
                case 'Needs Improvement': return 'badge-high';
                default: return 'badge-medium';
            }
        }

        function getRankIcon(rank) {
            switch (rank) {
                case 1: return 'ü•á';
                case 2: return 'ü•à';
                case 3: return 'ü•â';
                default: return 'üìç';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function initializeChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            // Calculate distribution
            const excellent = rankingsData.filter(item => item.score >= 80).length;
            const good = rankingsData.filter(item => item.score >= 70 && item.score < 80).length;
            const average = rankingsData.filter(item => item.score >= 60 && item.score < 70).length;
            const needsImprovement = rankingsData.filter(item => item.score < 60).length;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Excellent\n(80-100)', 'Good\n(70-79)', 'Average\n(60-69)', 'Needs Improvement\n(<60)'],
                    datasets: [{
                        label: 'Number of Institutions',
                        data: [excellent, good, average, needsImprovement],
                        backgroundColor: [
                            '#10b981', // Success green
                            '#3b82f6', // Info blue  
                            '#f59e0b', // Warning amber
                            '#dc2626'  // Primary red
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 0,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>